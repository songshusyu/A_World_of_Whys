<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœç´¢åŠŸèƒ½æµ‹è¯•</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .module-card { margin-bottom: 1rem; }
        .loading-spinner { text-align: center; padding: 2rem; }
        .error-message { color: red; margin: 1rem 0; }
        .success-message { color: green; margin: 1rem 0; }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h2>ğŸ§ª æœç´¢åŠŸèƒ½æµ‹è¯•é¡µé¢</h2>
        
        <!-- æœç´¢åŒºåŸŸ -->
        <div class="row mb-4">
            <div class="col-md-8">
                <div class="input-group">
                    <input type="text" class="form-control" id="searchInput" 
                           placeholder="è¾“å…¥æœç´¢å…³é”®è¯ï¼Œå¦‚ï¼šå¦‚ä½•åˆ›ä½œä¸€é¦–éŸ³ä¹" value="å¦‚ä½•åˆ›ä½œä¸€é¦–éŸ³ä¹">
                    <button class="btn btn-primary" id="searchBtn">ğŸ” æœç´¢</button>
                </div>
            </div>
        </div>

        <!-- è¿æ¥çŠ¶æ€ -->
        <div id="connectionStatus" class="alert alert-info">
            ğŸ”„ æ£€æŸ¥æœåŠ¡å™¨è¿æ¥çŠ¶æ€...
        </div>

        <!-- æœç´¢ç»“æœ -->
        <div id="searchResults"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        class SearchTester {
            constructor() {
                this.apiBaseUrl = 'http://localhost:8080/api';
                this.init();
            }

            init() {
                // ç»‘å®šäº‹ä»¶
                document.getElementById('searchBtn').addEventListener('click', () => {
                    const keyword = document.getElementById('searchInput').value;
                    this.testSearch(keyword);
                });

                // å›è½¦æœç´¢
                document.getElementById('searchInput').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        const keyword = e.target.value;
                        this.testSearch(keyword);
                    }
                });

                // æµ‹è¯•è¿æ¥
                this.testConnection();
            }

            async testConnection() {
                const statusEl = document.getElementById('connectionStatus');
                statusEl.innerHTML = 'ğŸ”„ æ­£åœ¨æ£€æŸ¥åç«¯è¿æ¥...';

                try {
                    // å°è¯•è¿æ¥åç«¯å¥åº·æ£€æŸ¥æ¥å£
                    const response = await fetch(`${this.apiBaseUrl}/search/trending`, {
                        method: 'GET',
                        headers: { 'Accept': 'application/json' }
                    });

                    if (response.ok) {
                        statusEl.className = 'alert alert-success';
                        statusEl.innerHTML = 'âœ… åç«¯è¿æ¥æ­£å¸¸ï¼å¯ä»¥å¼€å§‹æµ‹è¯•æœç´¢åŠŸèƒ½ã€‚';
                    } else {
                        throw new Error(`HTTP ${response.status}`);
                    }
                } catch (error) {
                    statusEl.className = 'alert alert-danger';
                    statusEl.innerHTML = `âŒ åç«¯è¿æ¥å¤±è´¥: ${error.message}<br>
                                        ğŸ“ è¯·ç¡®ä¿åç«¯æœåŠ¡å™¨åœ¨8080ç«¯å£è¿è¡Œ<br>
                                        ğŸ”§ å¯ä»¥å…ˆæµ‹è¯•å‰ç«¯åŠŸèƒ½çš„æ¨¡æ‹Ÿæ•°æ®`;
                    
                    // æ˜¾ç¤ºæ¨¡æ‹Ÿæ•°æ®æŒ‰é’®
                    statusEl.innerHTML += `<br><button class="btn btn-warning mt-2" onclick="searchTester.showMockData()">ğŸ­ æ˜¾ç¤ºæ¨¡æ‹Ÿæ•°æ®</button>`;
                }
            }

            async testSearch(keyword) {
                if (!keyword.trim()) {
                    alert('è¯·è¾“å…¥æœç´¢å…³é”®è¯');
                    return;
                }

                const resultsEl = document.getElementById('searchResults');
                resultsEl.innerHTML = `
                    <div class="loading-spinner">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p class="mt-2">æ­£åœ¨æœç´¢"${keyword}"...</p>
                    </div>
                `;

                try {
                    const response = await fetch(
                        `${this.apiBaseUrl}/search/modules?keyword=${encodeURIComponent(keyword)}&page=0&size=6`,
                        {
                            method: 'GET',
                            headers: { 'Accept': 'application/json' }
                        }
                    );

                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }

                    const result = await response.json();
                    
                    if (result.success && result.data) {
                        this.displayResults(result.data, keyword);
                    } else {
                        throw new Error(result.message || 'æœç´¢å¤±è´¥');
                    }

                } catch (error) {
                    resultsEl.innerHTML = `
                        <div class="alert alert-danger">
                            <h5>âŒ æœç´¢å¤±è´¥</h5>
                            <p><strong>é”™è¯¯ä¿¡æ¯:</strong> ${error.message}</p>
                            <p><strong>å¯èƒ½åŸå› :</strong></p>
                            <ul>
                                <li>åç«¯æœåŠ¡å™¨æœªå¯åŠ¨ï¼ˆæ£€æŸ¥8080ç«¯å£ï¼‰</li>
                                <li>CORSè·¨åŸŸé—®é¢˜</li>
                                <li>ç½‘ç»œè¿æ¥é—®é¢˜</li>
                            </ul>
                            <button class="btn btn-warning" onclick="searchTester.showMockData('${keyword}')">ğŸ­ æŸ¥çœ‹æ¨¡æ‹Ÿç»“æœ</button>
                        </div>
                    `;
                }
            }

            displayResults(modules, keyword) {
                const resultsEl = document.getElementById('searchResults');
                
                if (!modules.length) {
                    resultsEl.innerHTML = `
                        <div class="alert alert-warning">
                            <h5>ğŸ“ æ²¡æœ‰æ‰¾åˆ°ç›¸å…³è¯¾ç¨‹</h5>
                            <p>å…³é”®è¯"${keyword}"æ²¡æœ‰åŒ¹é…çš„å­¦ä¹ æ¨¡å—</p>
                        </div>
                    `;
                    return;
                }

                const cardsHTML = modules.map(module => `
                    <div class="col-md-6 col-lg-4 mb-3">
                        <div class="card h-100">
                            <div class="card-header bg-primary text-white">
                                <h6 class="mb-0">ğŸ“š ${module.title}</h6>
                            </div>
                            <div class="card-body">
                                <p class="card-text">${module.description}</p>
                                <div class="mb-2">
                                    ${module.tags.map(tag => `<span class="badge bg-secondary me-1">${tag}</span>`).join('')}
                                </div>
                                <small class="text-muted">
                                    â±ï¸ ${module.estimatedTime} | 
                                    â­ ${module.rating} (${module.reviewCount}æ¡è¯„ä»·)
                                </small>
                            </div>
                            <div class="card-footer">
                                <button class="btn btn-primary btn-sm w-100">â–¶ï¸ å¼€å§‹å­¦ä¹ </button>
                            </div>
                        </div>
                    </div>
                `).join('');

                resultsEl.innerHTML = `
                    <div class="alert alert-success">
                        <h5>âœ… æœç´¢æˆåŠŸï¼</h5>
                        <p>æ‰¾åˆ° <strong>${modules.length}</strong> ä¸ªå…³äº"${keyword}"çš„è¯¾ç¨‹</p>
                    </div>
                    <div class="row">
                        ${cardsHTML}
                    </div>
                `;
            }

            showMockData(keyword = 'å¦‚ä½•åˆ›ä½œä¸€é¦–éŸ³ä¹') {
                // æ¨¡æ‹ŸéŸ³ä¹åˆ›ä½œç›¸å…³çš„å­¦ä¹ æ¨¡å—
                const mockModules = [
                    {
                        moduleId: 'music-theory-basics',
                        title: 'éŸ³ä¹ç†è®ºåŸºç¡€',
                        description: 'å­¦ä¹ éŸ³ä¹ã€å’Œå¼¦ã€èŠ‚å¥ç­‰åŸºç¡€çŸ¥è¯†ï¼Œå¥ å®šéŸ³ä¹åˆ›ä½œåŸºç¡€ã€‚',
                        difficulty: 'beginner',
                        category: 'music',
                        estimatedTime: '3å°æ—¶',
                        tags: ['éŸ³ä¹ç†è®º', 'åŸºç¡€', 'å…¥é—¨'],
                        rating: 4.8,
                        reviewCount: 156
                    },
                    {
                        moduleId: 'creative-inspiration',
                        title: 'åˆ›ä½œçµæ„Ÿä¸æ„æ€',
                        description: 'æ¿€å‘åˆ›ä½œçµæ„Ÿï¼Œæ„å»ºæ—‹å¾‹å’Œå’Œå¼¦è¿›è¡Œï¼Œå½¢æˆéŸ³ä¹ä¸»é¢˜ã€‚',
                        difficulty: 'intermediate',
                        category: 'music',
                        estimatedTime: '2.5å°æ—¶',
                        tags: ['åˆ›ä½œ', 'çµæ„Ÿ', 'æ—‹å¾‹'],
                        rating: 4.6,
                        reviewCount: 124
                    },
                    {
                        moduleId: 'composition-techniques',
                        title: 'ç¼–æ›²ä¸ä¹å™¨è¿ç”¨',
                        description: 'æŒæ¡ç¼–æ›²æŠ€å·§ï¼Œå­¦ä¹ ä¹å™¨éŸ³è‰²ä¸æ­é…ï¼Œä¸°å¯ŒéŸ³ä¹ä½œå“ã€‚',
                        difficulty: 'intermediate',
                        category: 'music',
                        estimatedTime: '4å°æ—¶',
                        tags: ['ç¼–æ›²', 'ä¹å™¨', 'éŸ³è‰²'],
                        rating: 4.7,
                        reviewCount: 98
                    },
                    {
                        moduleId: 'recording-production',
                        title: 'å½•éŸ³ä¸åæœŸåˆ¶ä½œ',
                        description: 'äº†è§£å½•éŸ³æŠ€æœ¯ï¼Œå­¦ä¹ éŸ³é¢‘ç¼–è¾‘ä¸æ··éŸ³ï¼Œå®ŒæˆéŸ³ä¹ä½œå“ã€‚',
                        difficulty: 'advanced',
                        category: 'music',
                        estimatedTime: '5å°æ—¶',
                        tags: ['å½•éŸ³', 'åæœŸ', 'æ··éŸ³'],
                        rating: 4.5,
                        reviewCount: 87
                    }
                ];

                this.displayResults(mockModules, keyword);
                
                // æ·»åŠ æç¤º
                const resultsEl = document.getElementById('searchResults');
                resultsEl.insertAdjacentHTML('afterbegin', `
                    <div class="alert alert-info">
                        <h6>ğŸ­ è¿™æ˜¯æ¨¡æ‹Ÿæ•°æ®</h6>
                        <p>ç”±äºåç«¯æœåŠ¡å™¨æœªè¿æ¥ï¼Œæ˜¾ç¤ºçš„æ˜¯å‰ç«¯æ¨¡æ‹Ÿçš„æœç´¢ç»“æœã€‚å®é™…éƒ¨ç½²æ—¶ï¼Œè¿™äº›æ•°æ®å°†ç”±åç«¯APIåŠ¨æ€ç”Ÿæˆã€‚</p>
                    </div>
                `);
            }
        }

        // åˆå§‹åŒ–æµ‹è¯•å™¨
        const searchTester = new SearchTester();
    </script>
</body>
</html> 